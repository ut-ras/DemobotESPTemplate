# Board definitions
CORE_DEBUG_LEVEL ?= 0
F_CPU ?= 240000000L
FLASH_MODE ?= dio
FLASH_SPEED ?= 40m
UPLOAD_RESET ?= 
UPLOAD_SPEED ?= 921600
COMP_WARNINGS ?= -w
INCLUDE_VARIANT = esp32
VTABLE_FLAGS?=-DVTABLES_IN_FLASH
MMU_FLAGS?=-DMMU_IRAM_SIZE=0x8000 -DMMU_ICACHE_SIZE=0x8000
SSL_FLAGS?=
BOOT_LOADER?=$(ESP_ROOT)/bootloaders/eboot/eboot.elf
# Commands
C_COM=$(C_COM_PREFIX) "$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-gcc" -DESP_PLATFORM -DMBEDTLS_CONFIG_FILE=\"mbedtls/esp_config.h\" -DHAVE_CONFIG_H -DGCC_NOT_5_2_0=0 -DWITH_POSIX "-I$(ESP_ROOT)/tools/sdk/include/config" "-I$(ESP_ROOT)/tools/sdk/include/app_trace" "-I$(ESP_ROOT)/tools/sdk/include/app_update" "-I$(ESP_ROOT)/tools/sdk/include/asio" "-I$(ESP_ROOT)/tools/sdk/include/bootloader_support" "-I$(ESP_ROOT)/tools/sdk/include/bt" "-I$(ESP_ROOT)/tools/sdk/include/coap" "-I$(ESP_ROOT)/tools/sdk/include/console" "-I$(ESP_ROOT)/tools/sdk/include/driver" "-I$(ESP_ROOT)/tools/sdk/include/efuse" "-I$(ESP_ROOT)/tools/sdk/include/esp-tls" "-I$(ESP_ROOT)/tools/sdk/include/esp32" "-I$(ESP_ROOT)/tools/sdk/include/esp_adc_cal" "-I$(ESP_ROOT)/tools/sdk/include/esp_event" "-I$(ESP_ROOT)/tools/sdk/include/esp_http_client" "-I$(ESP_ROOT)/tools/sdk/include/esp_http_server" "-I$(ESP_ROOT)/tools/sdk/include/esp_https_ota" "-I$(ESP_ROOT)/tools/sdk/include/esp_https_server" "-I$(ESP_ROOT)/tools/sdk/include/esp_ringbuf" "-I$(ESP_ROOT)/tools/sdk/include/esp_websocket_client" "-I$(ESP_ROOT)/tools/sdk/include/espcoredump" "-I$(ESP_ROOT)/tools/sdk/include/ethernet" "-I$(ESP_ROOT)/tools/sdk/include/expat" "-I$(ESP_ROOT)/tools/sdk/include/fatfs" "-I$(ESP_ROOT)/tools/sdk/include/freemodbus" "-I$(ESP_ROOT)/tools/sdk/include/freertos" "-I$(ESP_ROOT)/tools/sdk/include/heap" "-I$(ESP_ROOT)/tools/sdk/include/idf_test" "-I$(ESP_ROOT)/tools/sdk/include/jsmn" "-I$(ESP_ROOT)/tools/sdk/include/json" "-I$(ESP_ROOT)/tools/sdk/include/libsodium" "-I$(ESP_ROOT)/tools/sdk/include/log" "-I$(ESP_ROOT)/tools/sdk/include/lwip" "-I$(ESP_ROOT)/tools/sdk/include/mbedtls" "-I$(ESP_ROOT)/tools/sdk/include/mdns" "-I$(ESP_ROOT)/tools/sdk/include/micro-ecc" "-I$(ESP_ROOT)/tools/sdk/include/mqtt" "-I$(ESP_ROOT)/tools/sdk/include/newlib" "-I$(ESP_ROOT)/tools/sdk/include/nghttp" "-I$(ESP_ROOT)/tools/sdk/include/nvs_flash" "-I$(ESP_ROOT)/tools/sdk/include/openssl" "-I$(ESP_ROOT)/tools/sdk/include/protobuf-c" "-I$(ESP_ROOT)/tools/sdk/include/protocomm" "-I$(ESP_ROOT)/tools/sdk/include/pthread" "-I$(ESP_ROOT)/tools/sdk/include/sdmmc" "-I$(ESP_ROOT)/tools/sdk/include/smartconfig_ack" "-I$(ESP_ROOT)/tools/sdk/include/soc" "-I$(ESP_ROOT)/tools/sdk/include/spi_flash" "-I$(ESP_ROOT)/tools/sdk/include/spiffs" "-I$(ESP_ROOT)/tools/sdk/include/tcp_transport" "-I$(ESP_ROOT)/tools/sdk/include/tcpip_adapter" "-I$(ESP_ROOT)/tools/sdk/include/ulp" "-I$(ESP_ROOT)/tools/sdk/include/unity" "-I$(ESP_ROOT)/tools/sdk/include/vfs" "-I$(ESP_ROOT)/tools/sdk/include/wear_levelling" "-I$(ESP_ROOT)/tools/sdk/include/wifi_provisioning" "-I$(ESP_ROOT)/tools/sdk/include/wpa_supplicant" "-I$(ESP_ROOT)/tools/sdk/include/xtensa-debug-module" "-I$(ESP_ROOT)/tools/sdk/include/esp-face" "-I$(ESP_ROOT)/tools/sdk/include/esp32-camera" "-I$(ESP_ROOT)/tools/sdk/include/esp-face" "-I$(ESP_ROOT)/tools/sdk/include/fb_gfx" $(C_PRE_PROC_FLAGS) -std=gnu99 -Os -g3 -fstack-protector -ffunction-sections -fdata-sections -fstrict-volatile-bitfields -mlongcalls -nostdlib -Wpointer-arith $(COMP_WARNINGS) -Wno-maybe-uninitialized -Wno-unused-function -Wno-unused-but-set-variable -Wno-unused-variable -Wno-deprecated-declarations -Wno-unused-parameter -Wno-sign-compare -Wno-old-style-declaration -MMD -c -DF_CPU=$(F_CPU) -DARDUINO=10605 -DARDUINO_ESP32_DEV -DARDUINO_ARCH_$(UC_CHIP) -DARDUINO_BOARD=\"ESP32_DEV\" -DARDUINO_VARIANT=\"esp32\"  -DESP32 -DCORE_DEBUG_LEVEL=$(CORE_DEBUG_LEVEL)  $(BUILD_EXTRA_FLAGS) $(C_INCLUDES) 
CPP_COM=$(CPP_COM_PREFIX) "$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-g++" -DESP_PLATFORM -DMBEDTLS_CONFIG_FILE=\"mbedtls/esp_config.h\" -DHAVE_CONFIG_H -DGCC_NOT_5_2_0=0 -DWITH_POSIX "-I$(ESP_ROOT)/tools/sdk/include/config" "-I$(ESP_ROOT)/tools/sdk/include/app_trace" "-I$(ESP_ROOT)/tools/sdk/include/app_update" "-I$(ESP_ROOT)/tools/sdk/include/asio" "-I$(ESP_ROOT)/tools/sdk/include/bootloader_support" "-I$(ESP_ROOT)/tools/sdk/include/bt" "-I$(ESP_ROOT)/tools/sdk/include/coap" "-I$(ESP_ROOT)/tools/sdk/include/console" "-I$(ESP_ROOT)/tools/sdk/include/driver" "-I$(ESP_ROOT)/tools/sdk/include/efuse" "-I$(ESP_ROOT)/tools/sdk/include/esp-tls" "-I$(ESP_ROOT)/tools/sdk/include/esp32" "-I$(ESP_ROOT)/tools/sdk/include/esp_adc_cal" "-I$(ESP_ROOT)/tools/sdk/include/esp_event" "-I$(ESP_ROOT)/tools/sdk/include/esp_http_client" "-I$(ESP_ROOT)/tools/sdk/include/esp_http_server" "-I$(ESP_ROOT)/tools/sdk/include/esp_https_ota" "-I$(ESP_ROOT)/tools/sdk/include/esp_https_server" "-I$(ESP_ROOT)/tools/sdk/include/esp_ringbuf" "-I$(ESP_ROOT)/tools/sdk/include/esp_websocket_client" "-I$(ESP_ROOT)/tools/sdk/include/espcoredump" "-I$(ESP_ROOT)/tools/sdk/include/ethernet" "-I$(ESP_ROOT)/tools/sdk/include/expat" "-I$(ESP_ROOT)/tools/sdk/include/fatfs" "-I$(ESP_ROOT)/tools/sdk/include/freemodbus" "-I$(ESP_ROOT)/tools/sdk/include/freertos" "-I$(ESP_ROOT)/tools/sdk/include/heap" "-I$(ESP_ROOT)/tools/sdk/include/idf_test" "-I$(ESP_ROOT)/tools/sdk/include/jsmn" "-I$(ESP_ROOT)/tools/sdk/include/json" "-I$(ESP_ROOT)/tools/sdk/include/libsodium" "-I$(ESP_ROOT)/tools/sdk/include/log" "-I$(ESP_ROOT)/tools/sdk/include/lwip" "-I$(ESP_ROOT)/tools/sdk/include/mbedtls" "-I$(ESP_ROOT)/tools/sdk/include/mdns" "-I$(ESP_ROOT)/tools/sdk/include/micro-ecc" "-I$(ESP_ROOT)/tools/sdk/include/mqtt" "-I$(ESP_ROOT)/tools/sdk/include/newlib" "-I$(ESP_ROOT)/tools/sdk/include/nghttp" "-I$(ESP_ROOT)/tools/sdk/include/nvs_flash" "-I$(ESP_ROOT)/tools/sdk/include/openssl" "-I$(ESP_ROOT)/tools/sdk/include/protobuf-c" "-I$(ESP_ROOT)/tools/sdk/include/protocomm" "-I$(ESP_ROOT)/tools/sdk/include/pthread" "-I$(ESP_ROOT)/tools/sdk/include/sdmmc" "-I$(ESP_ROOT)/tools/sdk/include/smartconfig_ack" "-I$(ESP_ROOT)/tools/sdk/include/soc" "-I$(ESP_ROOT)/tools/sdk/include/spi_flash" "-I$(ESP_ROOT)/tools/sdk/include/spiffs" "-I$(ESP_ROOT)/tools/sdk/include/tcp_transport" "-I$(ESP_ROOT)/tools/sdk/include/tcpip_adapter" "-I$(ESP_ROOT)/tools/sdk/include/ulp" "-I$(ESP_ROOT)/tools/sdk/include/unity" "-I$(ESP_ROOT)/tools/sdk/include/vfs" "-I$(ESP_ROOT)/tools/sdk/include/wear_levelling" "-I$(ESP_ROOT)/tools/sdk/include/wifi_provisioning" "-I$(ESP_ROOT)/tools/sdk/include/wpa_supplicant" "-I$(ESP_ROOT)/tools/sdk/include/xtensa-debug-module" "-I$(ESP_ROOT)/tools/sdk/include/esp-face" "-I$(ESP_ROOT)/tools/sdk/include/esp32-camera" "-I$(ESP_ROOT)/tools/sdk/include/esp-face" "-I$(ESP_ROOT)/tools/sdk/include/fb_gfx" $(C_PRE_PROC_FLAGS) -std=gnu++11 -Os -g3 -Wpointer-arith -fexceptions -fstack-protector -ffunction-sections -fdata-sections -fstrict-volatile-bitfields -mlongcalls -nostdlib $(COMP_WARNINGS) -Wno-error=maybe-uninitialized -Wno-error=unused-function -Wno-error=unused-but-set-variable -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wno-unused-parameter -Wno-unused-but-set-parameter -Wno-missing-field-initializers -Wno-sign-compare -fno-rtti -MMD -c -DF_CPU=$(F_CPU) -DARDUINO=10605 -DARDUINO_ESP32_DEV -DARDUINO_ARCH_$(UC_CHIP) -DARDUINO_BOARD=\"ESP32_DEV\" -DARDUINO_VARIANT=\"esp32\"  -DESP32 -DCORE_DEBUG_LEVEL=$(CORE_DEBUG_LEVEL)  $(BUILD_EXTRA_FLAGS) $(C_INCLUDES) 
S_COM="$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-gcc" -DESP_PLATFORM -DMBEDTLS_CONFIG_FILE=\"mbedtls/esp_config.h\" -DHAVE_CONFIG_H -DGCC_NOT_5_2_0=0 -DWITH_POSIX "-I$(ESP_ROOT)/tools/sdk/include/config" "-I$(ESP_ROOT)/tools/sdk/include/app_trace" "-I$(ESP_ROOT)/tools/sdk/include/app_update" "-I$(ESP_ROOT)/tools/sdk/include/asio" "-I$(ESP_ROOT)/tools/sdk/include/bootloader_support" "-I$(ESP_ROOT)/tools/sdk/include/bt" "-I$(ESP_ROOT)/tools/sdk/include/coap" "-I$(ESP_ROOT)/tools/sdk/include/console" "-I$(ESP_ROOT)/tools/sdk/include/driver" "-I$(ESP_ROOT)/tools/sdk/include/efuse" "-I$(ESP_ROOT)/tools/sdk/include/esp-tls" "-I$(ESP_ROOT)/tools/sdk/include/esp32" "-I$(ESP_ROOT)/tools/sdk/include/esp_adc_cal" "-I$(ESP_ROOT)/tools/sdk/include/esp_event" "-I$(ESP_ROOT)/tools/sdk/include/esp_http_client" "-I$(ESP_ROOT)/tools/sdk/include/esp_http_server" "-I$(ESP_ROOT)/tools/sdk/include/esp_https_ota" "-I$(ESP_ROOT)/tools/sdk/include/esp_https_server" "-I$(ESP_ROOT)/tools/sdk/include/esp_ringbuf" "-I$(ESP_ROOT)/tools/sdk/include/esp_websocket_client" "-I$(ESP_ROOT)/tools/sdk/include/espcoredump" "-I$(ESP_ROOT)/tools/sdk/include/ethernet" "-I$(ESP_ROOT)/tools/sdk/include/expat" "-I$(ESP_ROOT)/tools/sdk/include/fatfs" "-I$(ESP_ROOT)/tools/sdk/include/freemodbus" "-I$(ESP_ROOT)/tools/sdk/include/freertos" "-I$(ESP_ROOT)/tools/sdk/include/heap" "-I$(ESP_ROOT)/tools/sdk/include/idf_test" "-I$(ESP_ROOT)/tools/sdk/include/jsmn" "-I$(ESP_ROOT)/tools/sdk/include/json" "-I$(ESP_ROOT)/tools/sdk/include/libsodium" "-I$(ESP_ROOT)/tools/sdk/include/log" "-I$(ESP_ROOT)/tools/sdk/include/lwip" "-I$(ESP_ROOT)/tools/sdk/include/mbedtls" "-I$(ESP_ROOT)/tools/sdk/include/mdns" "-I$(ESP_ROOT)/tools/sdk/include/micro-ecc" "-I$(ESP_ROOT)/tools/sdk/include/mqtt" "-I$(ESP_ROOT)/tools/sdk/include/newlib" "-I$(ESP_ROOT)/tools/sdk/include/nghttp" "-I$(ESP_ROOT)/tools/sdk/include/nvs_flash" "-I$(ESP_ROOT)/tools/sdk/include/openssl" "-I$(ESP_ROOT)/tools/sdk/include/protobuf-c" "-I$(ESP_ROOT)/tools/sdk/include/protocomm" "-I$(ESP_ROOT)/tools/sdk/include/pthread" "-I$(ESP_ROOT)/tools/sdk/include/sdmmc" "-I$(ESP_ROOT)/tools/sdk/include/smartconfig_ack" "-I$(ESP_ROOT)/tools/sdk/include/soc" "-I$(ESP_ROOT)/tools/sdk/include/spi_flash" "-I$(ESP_ROOT)/tools/sdk/include/spiffs" "-I$(ESP_ROOT)/tools/sdk/include/tcp_transport" "-I$(ESP_ROOT)/tools/sdk/include/tcpip_adapter" "-I$(ESP_ROOT)/tools/sdk/include/ulp" "-I$(ESP_ROOT)/tools/sdk/include/unity" "-I$(ESP_ROOT)/tools/sdk/include/vfs" "-I$(ESP_ROOT)/tools/sdk/include/wear_levelling" "-I$(ESP_ROOT)/tools/sdk/include/wifi_provisioning" "-I$(ESP_ROOT)/tools/sdk/include/wpa_supplicant" "-I$(ESP_ROOT)/tools/sdk/include/xtensa-debug-module" "-I$(ESP_ROOT)/tools/sdk/include/esp-face" "-I$(ESP_ROOT)/tools/sdk/include/esp32-camera" "-I$(ESP_ROOT)/tools/sdk/include/esp-face" "-I$(ESP_ROOT)/tools/sdk/include/fb_gfx" $(C_PRE_PROC_FLAGS) -c -g3 -x assembler-with-cpp -MMD -mlongcalls -DF_CPU=$(F_CPU) -DARDUINO=10605 -DARDUINO_ESP32_DEV -DARDUINO_ARCH_$(UC_CHIP) -DARDUINO_BOARD=\"ESP32_DEV\" -DARDUINO_VARIANT=\"esp32\"  -DESP32 -DCORE_DEBUG_LEVEL=$(CORE_DEBUG_LEVEL)  $(BUILD_EXTRA_FLAGS) $(C_INCLUDES) 
LIB_COM="$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-ar"
CORE_LIB_COM="$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-ar" cru  "$(CORE_LIB)" 
LD_COM="$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-gcc" -nostdlib "-L$(ESP_ROOT)/tools/sdk/lib" "-L$(ESP_ROOT)/tools/sdk/ld" -T esp32_out.ld -T esp32.project.ld -T esp32.rom.ld -T esp32.peripherals.ld -T esp32.rom.libgcc.ld -T esp32.rom.spiram_incompatible_fns.ld -u esp_app_desc -u ld_include_panic_highint_hdl -u call_user_start_cpu0 -Wl,--gc-sections -Wl,-static -Wl,--undefined=uxTopUsedPriority  -u __cxa_guard_dummy -u __cxx_fatal_exception   -Wl,--start-group $^ $(BUILD_INFO_OBJ) "$(CORE_LIB)" -lgcc -ltcp_transport -lc -llog -lapp_update -llibsodium -lfatfs -lsmartconfig -lfd -lcore -limage_util -lpe -lulp -lsdmmc -lesp32 -lesp_https_server -lasio -lesp_event -lfr -llwip -lmicro-ecc -ldetection_cat_face -lbootloader_support -lesp_http_server -lethernet -lpthread -lfreertos -lapp_trace -ljson -lface_recognition -ldl -lfreemodbus -lnvs_flash -lhal -lspiffs -lmdns -lmqtt -lunity -lheap -lsoc -lefuse -ldetection -lcoap -lcxx -lfb_gfx -lesp_websocket_client -lprotocomm -lwear_levelling -lesp-tls -lnet80211 -lnghttp -lmbedtls -ltcpip_adapter -lespnow -lespcoredump -ljsmn -lc_nano -lesp_ringbuf -lpp -lexpat -lm -lface_detection -lmesh -lxtensa-debug-module -lrtc -lphy -ldriver -lod -lopenssl -lwpa -lwifi_provisioning -lwpa_supplicant -lesp_http_client -lnewlib -lconsole -lesp_https_ota -lprotobuf-c -lesp_adc_cal -lcoexist -lwps -lesp32-camera -lbtdm_app -lwpa2 -lvfs -lsmartconfig_ack -lspi_flash -lbt  -lstdc++  -Wl,--end-group -Wl,-EL -o "$(BUILD_DIR)/$(MAIN_NAME).elf"
PART_FILE?=$(ESP_ROOT)/tools/partitions/default.csv
GEN_PART_COM=python "$(ESP_ROOT)/tools/gen_esp32part.py" -q $(PART_FILE) "$(BUILD_DIR)/$(MAIN_NAME).partitions.bin"
OBJCOPY=python "$(ESP_ROOT)/tools/esptool/esptool.py" --chip esp32 elf2image --flash_mode "$(FLASH_MODE)" --flash_freq "$(FLASH_SPEED)" --flash_size "4MB" -o "$(BUILD_DIR)/$(MAIN_NAME).bin" "$(BUILD_DIR)/$(MAIN_NAME).elf"
SIZE_COM="$(ESP_ROOT)/tools/xtensa-esp32-elf/bin/xtensa-esp32-elf-size" -A "$(BUILD_DIR)/$(MAIN_NAME).elf"
ESPTOOL_COM?=$(ESP_ROOT)/tools/esptool/esptool.py
UPLOAD_COM?=python "$(ESP_ROOT)/tools/esptool/esptool.py" --chip esp32 --port "$(UPLOAD_PORT)" --baud $(UPLOAD_SPEED)  --before default_reset --after hard_reset write_flash -z --flash_mode $(FLASH_MODE) --flash_freq $(FLASH_SPEED) --flash_size detect 0xe000 "$(ESP_ROOT)/tools/partitions/boot_app0.bin" 0x1000 "$(ESP_ROOT)/tools/sdk/bin/bootloader_dio_$(FLASH_SPEED).bin" 0x10000 "$(BUILD_DIR)/$(MAIN_NAME).bin" 0x8000 "$(BUILD_DIR)/$(MAIN_NAME).partitions.bin"
COMMA=,
SPIFFS_SPEC:=$(subst $(COMMA), ,$(shell grep spiffs $(PART_FILE)))
SPIFFS_START:=$(word 4,$(SPIFFS_SPEC))
SPIFFS_SIZE:=$(word 5,$(SPIFFS_SPEC))
SPIFFS_BLOCK_SIZE?=4096
MK_FS_COM?="$(MK_FS_PATH)" -b $(SPIFFS_BLOCK_SIZE) -s $(SPIFFS_SIZE) -c $(FS_DIR) $(FS_IMAGE)
RESTORE_FS_COM?="$(MK_FS_PATH)" -b $(SPIFFS_BLOCK_SIZE) -s $(SPIFFS_SIZE) -u $(FS_RESTORE_DIR) $(FS_IMAGE)
FS_UPLOAD_COM?=python "$(ESP_ROOT)/tools/esptool/esptool.py" --chip esp32 --port "$(UPLOAD_PORT)" --baud $(UPLOAD_SPEED)  --before default_reset --after hard_reset write_flash -z --flash_mode $(FLASH_MODE) --flash_freq $(FLASH_SPEED) --flash_size detect $(SPIFFS_START) $(FS_IMAGE)
CORE_PREBUILD=
SKETCH_PREBUILD=
LINK_PREBUILD=
MEM_FLASH=^(?:\.iram0\.text|\.iram0\.vectors|\.dram0\.data|\.flash\.text|\.flash\.rodata|)\s+([0-9]+).*
MEM_RAM=^(?:\.dram0\.data|\.dram0\.bss|\.noinit)\s+([0-9]+).*
FLASH_INFO=4MB (32Mb)
LWIP_INFO=
